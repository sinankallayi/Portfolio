<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Compressor | AI Tools</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@100;300;400;700&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Browser Image Compression -->
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js"></script>

    <!-- Three.js for 3D Animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Space Grotesk"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    colors: {
                        black: '#050505',
                        white: '#fafafa',
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #666;
        }

        /* Dot Pattern Background */
        .bg-dots {
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 24px 24px;
        }

        .dark .bg-dots {
            background-image: radial-gradient(#333 1px, transparent 1px);
        }

        /* Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .dark .glass-panel {
            background: rgba(10, 10, 10, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
        }

        /* Canvas Positioning */
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
            opacity: 0.6;
        }
    </style>
</head>

<body
    class="bg-white text-black dark:bg-black dark:text-white transition-colors duration-500 overflow-x-hidden selection:bg-black selection:text-white dark:selection:bg-white dark:selection:text-black bg-dots min-h-screen flex flex-col">

    <!-- Three.js Canvas -->
    <div id="three-canvas"></div>

    <!-- Navigation -->
    <nav class="fixed top-0 w-full z-50 glass-panel border-b border-black/5 dark:border-white/5">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-6">
                <a href="index.html"
                    class="flex items-center gap-2 font-mono text-sm hover:opacity-70 transition-opacity">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i> BACK_TO_HOME
                </a>
                <a href="creativity.html"
                    class="font-mono text-sm font-bold hover:text-blue-500 transition-colors">CREATIVITY</a>
            </div>
            <button id="themeToggle"
                class="p-2 rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-all focus:outline-none">
                <i data-lucide="sun" class="w-5 h-5 hidden dark:block"></i>
                <i data-lucide="moon" class="w-5 h-5 block dark:hidden"></i>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="relative z-10 pt-32 pb-20 px-6 flex-grow flex flex-col items-center justify-center">

        <div class="max-w-4xl w-full">
            <div class="text-center mb-12">
                <h1
                    class="text-4xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-blue-400 to-cyan-300 bg-clip-text text-transparent inline-block">
                    IMAGE COMPRESSOR</h1>
                <p class="text-lg opacity-70">Reduce image file size efficiently without losing quality.</p>
            </div>

            <div class="glass-panel p-8 rounded-2xl">

                <!-- Upload Area -->
                <div id="upload-area"
                    class="border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl p-12 text-center cursor-pointer hover:border-blue-500 dark:hover:border-blue-500 transition-colors group relative">
                    <input type="file" id="file-input" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                        accept="image/*">
                    <div class="flex flex-col items-center gap-4 pointer-events-none">
                        <div
                            class="p-4 bg-gray-100 dark:bg-neutral-800 rounded-full group-hover:scale-110 transition-transform duration-300">
                            <i data-lucide="minimize-2" class="w-8 h-8 opacity-50"></i>
                        </div>
                        <div>
                            <p class="font-bold text-lg">Click or Drag & Drop to Upload</p>
                            <p class="text-sm opacity-50 font-mono mt-1">JPG, PNG, WEBP, BMP supported</p>
                        </div>
                    </div>
                </div>

                <!-- Options Area (Visible after upload selection) -->
                <div id="options-area" class="hidden mt-8">
                    <div class="flex flex-col md:flex-row gap-8 items-center justify-center">
                        <div class="w-full md:w-1/2">
                            <label class="block font-mono text-xs font-bold mb-2 opacity-70">MAX SIZE</label>
                            <div class="flex gap-2">
                                <input type="number" id="max-size" value="1" step="0.1" min="0.1"
                                    class="w-2/3 bg-gray-100 dark:bg-neutral-800 border border-gray-200 dark:border-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500 transition-colors">
                                <select id="size-unit"
                                    class="w-1/3 bg-gray-100 dark:bg-neutral-800 border border-gray-200 dark:border-gray-700 rounded-lg px-2 py-2 focus:outline-none focus:border-blue-500 transition-colors font-mono text-sm">
                                    <option value="MB">MB</option>
                                    <option value="KB">KB</option>
                                </select>
                            </div>
                        </div>
                        <div class="w-full md:w-1/2">
                            <label class="block font-mono text-xs font-bold mb-2 opacity-70">MAX WIDTH/HEIGHT
                                (PX)</label>
                            <input type="number" id="max-width-height" value="1920"
                                class="w-full bg-gray-100 dark:bg-neutral-800 border border-gray-200 dark:border-gray-700 rounded-lg px-4 py-2 focus:outline-none focus:border-blue-500 transition-colors">
                        </div>
                    </div>
                    <button id="compress-btn"
                        class="w-full mt-6 px-6 py-3 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-all font-mono text-sm font-bold flex items-center justify-center gap-2">
                        <i data-lucide="zap" class="w-4 h-4"></i> COMPRESS_IMAGE
                    </button>
                </div>

                <!-- Processing State -->
                <div id="processing-state" class="hidden py-12 text-center">
                    <div class="inline-block animate-spin mb-4">
                        <i data-lucide="loader-2" class="w-8 h-8 text-blue-500"></i>
                    </div>
                    <p class="font-mono animate-pulse">COMPRESSING...</p>
                </div>

                <!-- Result Area -->
                <div id="result-area" class="hidden mt-8 border-t border-black/5 dark:border-white/5 pt-8">
                    <div class="grid md:grid-cols-2 gap-8 mb-8">
                        <!-- Original Stats -->
                        <div class="text-center p-4 bg-red-500/10 rounded-xl border border-red-500/20">
                            <h3 class="font-mono text-xs font-bold mb-1 text-red-500">ORIGINAL SIZE</h3>
                            <p id="original-size" class="text-2xl font-bold">0 MB</p>
                        </div>

                        <!-- Result Stats -->
                        <div class="text-center p-4 bg-green-500/10 rounded-xl border border-green-500/20">
                            <h3 class="font-mono text-xs font-bold mb-1 text-green-500">COMPRESSED SIZE</h3>
                            <p id="compressed-size" class="text-2xl font-bold">0 MB</p>
                            <p id="savings" class="text-xs font-mono opacity-60 mt-1">SAVED 0%</p>
                        </div>
                    </div>

                    <div class="flex justify-center gap-4">
                        <button id="reset-btn"
                            class="px-6 py-3 rounded-lg border border-current hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black transition-all font-mono text-sm font-bold">
                            COMPRESS_NEW
                        </button>
                        <a id="download-btn" href="#" download="compressed-image.jpg"
                            class="px-6 py-3 rounded-lg bg-green-600 text-white hover:bg-green-700 transition-all font-mono text-sm font-bold flex items-center gap-2">
                            <i data-lucide="download" class="w-4 h-4"></i> DOWNLOAD
                        </a>
                    </div>
                </div>

            </div>
        </div>

    </main>

    <script>
        lucide.createIcons();

        // --- Three.js Fluid Wave Animation ---
        const container = document.getElementById('three-canvas');
        let scene, camera, renderer, particles;
        let mouseX = 0;
        let mouseY = 0;
        let windowHalfX = window.innerWidth / 2;
        let windowHalfY = window.innerHeight / 2;

        function initThree() {
            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 10000);
            camera.position.z = 1000;
            camera.position.y = 500;

            const SEPARATION = 100, AMOUNTX = 50, AMOUNTY = 50;
            const numParticles = AMOUNTX * AMOUNTY;
            const positions = new Float32Array(numParticles * 3);
            const scales = new Float32Array(numParticles);

            let i = 0, j = 0;
            for (let ix = 0; ix < AMOUNTX; ix++) {
                for (let iy = 0; iy < AMOUNTY; iy++) {
                    positions[i] = ix * SEPARATION - ((AMOUNTX * SEPARATION) / 2);
                    positions[i + 1] = 0;
                    positions[i + 2] = iy * SEPARATION - ((AMOUNTY * SEPARATION) / 2);
                    scales[j] = 1;
                    i += 3;
                    j++;
                }
            }

            const geometry = new THREE.BufferGeometry();
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            geometry.setAttribute('scale', new THREE.BufferAttribute(scales, 1));

            const isDark = document.documentElement.classList.contains('dark');
            const particleColor = isDark ? 0xffffff : 0x000000;

            const material = new THREE.PointsMaterial({
                color: particleColor,
                size: 3,
                sizeAttenuation: false
            });

            particles = new THREE.Points(geometry, material);
            scene.add(particles);

            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            container.style.touchAction = 'none';
            document.addEventListener('mousemove', onDocumentMouseMove, false);
            window.addEventListener('resize', onWindowResize, false);
        }

        function onWindowResize() {
            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onDocumentMouseMove(event) {
            mouseX = event.clientX - windowHalfX;
            mouseY = event.clientY - windowHalfY;
        }

        function animate() {
            requestAnimationFrame(animate);
            render();
        }

        function render() {
            camera.position.x += (mouseX - camera.position.x) * 0.05;
            camera.position.y += (-mouseY - camera.position.y) * 0.05;
            camera.lookAt(scene.position);

            const positions = particles.geometry.attributes.position.array;
            const scales = particles.geometry.attributes.scale.array;

            let i = 0, j = 0;
            const SEPARATION = 100, AMOUNTX = 50, AMOUNTY = 50;
            let count = Date.now() * 0.0005; // Use time for continuous animation

            for (let ix = 0; ix < AMOUNTX; ix++) {
                for (let iy = 0; iy < AMOUNTY; iy++) {
                    positions[i + 1] = (Math.sin((ix + count) * 0.3) * 50) +
                        (Math.sin((iy + count) * 0.5) * 50);
                    scales[j] = (Math.sin((ix + count) * 0.3) + 1) * 2 +
                        (Math.sin((iy + count) * 0.5) + 1) * 2;
                    i += 3;
                    j++;
                }
            }

            particles.geometry.attributes.position.needsUpdate = true;
            particles.geometry.attributes.scale.needsUpdate = true;

            renderer.render(scene, camera);
        }

        initThree();
        animate();

        // Update particle color on theme change
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'class') {
                    const isDark = document.documentElement.classList.contains('dark');
                    if (particles) {
                        particles.material.color.setHex(isDark ? 0xffffff : 0x000000);
                    }
                }
            });
        });

        observer.observe(document.documentElement, { attributes: true });

        // Theme Toggle Logic
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        // Check saved theme
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            html.classList.add('dark');
        } else {
            html.classList.remove('dark');
        }

        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            if (html.classList.contains('dark')) {
                localStorage.theme = 'dark';
            } else {
                localStorage.theme = 'light';
            }
        });

        const fileInput = document.getElementById('file-input');
        const uploadArea = document.getElementById('upload-area');
        const optionsArea = document.getElementById('options-area');
        const processingState = document.getElementById('processing-state');
        const resultArea = document.getElementById('result-area');
        const compressBtn = document.getElementById('compress-btn');
        const resetBtn = document.getElementById('reset-btn');
        const downloadBtn = document.getElementById('download-btn');

        const originalSizeEl = document.getElementById('original-size');
        const compressedSizeEl = document.getElementById('compressed-size');
        const savingsEl = document.getElementById('savings');

        let selectedFile = null;

        // Drag and drop effects
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-blue-500', 'bg-blue-50', 'dark:bg-blue-900/20');
            if (e.dataTransfer.files.length) {
                handleFileSelect(e.dataTransfer.files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length) {
                handleFileSelect(e.target.files[0]);
            }
        });

        function handleFileSelect(file) {
            if (!file.type.startsWith('image/')) {
                alert('Please upload an image file.');
                return;
            }

            selectedFile = file;
            optionsArea.classList.remove('hidden');
            resultArea.classList.add('hidden');

            // Show file name in upload area to indicate selection
            const fileNameDisplay = uploadArea.querySelector('p.font-bold');
            fileNameDisplay.textContent = file.name;
        }

        compressBtn.addEventListener('click', async () => {
            if (!selectedFile) return;

            optionsArea.classList.add('hidden');
            processingState.classList.remove('hidden');

            const maxSizeInput = document.getElementById('max-size');
            const sizeUnitSelect = document.getElementById('size-unit');
            const maxWidthOrHeight = parseInt(document.getElementById('max-width-height').value);

            let maxSizeMB = parseFloat(maxSizeInput.value);
            if (sizeUnitSelect.value === 'KB') {
                maxSizeMB = maxSizeMB / 1024;
            }

            const options = {
                maxSizeMB: maxSizeMB,
                maxWidthOrHeight: maxWidthOrHeight,
                useWebWorker: true
            };

            try {
                const compressedFile = await imageCompression(selectedFile, options);

                // Display stats
                originalSizeEl.textContent = formatBytes(selectedFile.size);
                compressedSizeEl.textContent = formatBytes(compressedFile.size);
                const savings = ((selectedFile.size - compressedFile.size) / selectedFile.size * 100).toFixed(2);
                savingsEl.textContent = `SAVED ${savings}%`;

                // Setup download
                const url = URL.createObjectURL(compressedFile);
                downloadBtn.href = url;
                downloadBtn.download = `compressed_${selectedFile.name}`;

                processingState.classList.add('hidden');
                resultArea.classList.remove('hidden');

            } catch (error) {
                console.error(error);
                alert('Error compressing image. Please try again.');
                processingState.classList.add('hidden');
                optionsArea.classList.remove('hidden');
            }
        });

        resetBtn.addEventListener('click', () => {
            resultArea.classList.add('hidden');
            optionsArea.classList.add('hidden');
            uploadArea.classList.remove('hidden');
            fileInput.value = ''; // Reset input
            selectedFile = null;

            // Reset text
            const fileNameDisplay = uploadArea.querySelector('p.font-bold');
            fileNameDisplay.textContent = 'Click or Drag & Drop to Upload';
        });

        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
    </script>
</body>

</html>